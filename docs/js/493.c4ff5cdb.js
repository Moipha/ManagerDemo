"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[493],{6493:function(t,e,a){a.r(e),a.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"flexColumn",staticStyle:{"overflow-y":"scroll","margin-top":"60px"}},[e("el-card",{staticClass:"box-card card flexColumn",staticStyle:{height:"150px","flex-shrink":"0","margin-top":"-70px"}},[e("span",{staticClass:"mText"},[t._v("线上访问统计")]),e("el-row",{staticStyle:{"margin-top":"20px"}},[e("el-col",{attrs:{span:8}},[e("div",{staticClass:"flexColumn",staticStyle:{"align-items":"center"}},[e("span",{staticClass:"lText",staticStyle:{"margin-bottom":"10px"}},[t._v(t._s(t.log.todayApiTimes))]),e("span",{staticClass:"sText"},[t._v("今日接口调用数")])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"flexColumn",staticStyle:{"align-items":"center"}},[e("span",{staticClass:"lText",staticStyle:{"margin-bottom":"10px"}},[t._v(t._s(t.log.yesterdayApiTimes))]),e("span",{staticClass:"sText"},[t._v("昨日接口调用数")])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"flexColumn",staticStyle:{"align-items":"center"}},[e("span",{staticClass:"lText",staticStyle:{"margin-bottom":"10px"}},[t._v(t._s(t.log.totalApiTimes))]),e("span",{staticClass:"sText"},[t._v("总接口调用数")])])])],1)],1),e("el-row",{staticStyle:{"margin-top":"20px"}},[e("el-col",{staticStyle:{"padding-right":"10px"},attrs:{span:12}},[e("el-card",{staticClass:"box-card card flexColumn"},[e("div",{ref:"chart1",staticStyle:{height:"360px"}}),e("div",{staticStyle:{color:"var(--deepText)","font-size":"20px",position:"absolute",left:"18%",bottom:"20px"}},[t._v("近日接口调用分布")])])],1),e("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:12}},[e("el-card",{staticClass:"box-card card flexColumn"},[e("div",{ref:"chart2",staticStyle:{height:"360px"}}),e("div",{staticStyle:{color:"var(--deepText)","font-size":"20px",position:"absolute",left:"68%",bottom:"20px"}},[t._v("近日接口调用数趋势")])])],1)],1),e("el-card",{staticClass:"box-card card flexColumn specialCard",staticStyle:{"margin-top":"20px","flex-shrink":"0"}},[e("div",{staticClass:"flexRow",staticStyle:{"margin-bottom":"30px"}},[e("span",{staticClass:"mText"},[t._v("具体日志记录")]),e("svg",{staticClass:"icon export",staticStyle:{"margin-left":"20px"},attrs:{t:"1697590550353",viewBox:"0 0 1201 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4116",width:"30",height:"30"},on:{click:t.exportRecords}},[e("path",{attrs:{d:"M399.257391 938.261011H88.553242V85.488174H1064.686376V255.940367a40.949476 40.949476 0 0 0 44.020686 42.485082 40.949476 40.949476 0 0 0 44.532555-42.485082V85.488174A87.529505 87.529505 0 0 0 1064.686376 0.006142H88.553242A87.529505 87.529505 0 0 0 0 85.488174v852.772837A87.529505 87.529505 0 0 0 88.553242 1023.743042H399.257391a42.99695 42.99695 0 1 0 0-85.482031z m358.307915-640.859299a40.437608 40.437608 0 0 0-45.556292-41.461345h-445.325552a41.973213 41.973213 0 1 0 0 83.434558h445.325552a40.949476 40.949476 0 0 0 44.532555-41.973213zM266.683462 470.413248a41.461344 41.461344 0 1 0 0 82.922689h223.174644a41.461344 41.461344 0 1 0 0-82.922689zM952.075317 351.147899a40.949476 40.949476 0 0 1 41.461344 40.949476v480.644474l135.645139-131.038323a41.973213 41.973213 0 0 1 70.637846 17.915396 41.461344 41.461344 0 0 1-11.261106 39.925739l-204.747379 200.140564a41.973213 41.973213 0 0 1-58.353004 0l-204.74738-200.140564a40.949476 40.949476 0 0 1-11.772974-39.925739 41.973213 41.973213 0 0 1 30.200239-28.664633 40.949476 40.949476 0 0 1 40.437607 10.749237l135.645139 131.038323V392.097375a41.461344 41.461344 0 0 1 41.973213-40.949476z m-460.681605 333.226361a41.973213 41.973213 0 1 1 0 83.434557H266.683462a41.973213 41.973213 0 1 1 0-83.434557z",fill:"currentColor","p-id":"4117"}})]),e("div",{staticStyle:{"margin-left":"auto"}},[e("el-input",{staticClass:"input",attrs:{"suffix-icon":"el-icon-search",clearable:""},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),e("el-dropdown",{attrs:{size:"large","split-button":"",trigger:"click"},on:{click:function(e){return t.search()},command:t.handleClick}},[e("span",{staticStyle:{color:"var(--btnText)"}},[t._v(t._s(t.btnWord))]),e("el-dropdown-menu",{ref:"dropdown",staticStyle:{"background-color":"var(--lightBg)!important",border:"none"},attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"desc_function"}},[t._v("根据接口描述搜索")]),e("el-dropdown-item",{attrs:{command:"user_id"}},[t._v("根据调用用户搜索")]),e("el-dropdown-item",{attrs:{command:"create_date"}},[t._v("根据调用日期搜索")])],1)],1)],1),e("div",{ref:"here"})]),e("el-table",{attrs:{data:t.logList,"header-cell-style":{height:"40px"},"row-style":{height:"62px"}}},[e("el-table-column",{attrs:{width:"10px"}}),e("el-table-column",{attrs:{prop:"descFunction",label:"接口描述"}}),e("el-table-column",{attrs:{prop:"times",label:"调用次数"}}),e("el-table-column",{attrs:{label:"调用用户"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.user&&a.row.user.name?e("span",[t._v(" "+t._s(a.row.user.name)+" ")]):e("span",[t._v("未知用户")])]}}])}),e("el-table-column",{attrs:{label:"所属关系"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.elders&&0!==a.row.elders.length?e("span",[t._l(a.row.elders,(function(a){return e("span",{key:a.elderlyId,staticStyle:{"font-size":"15px"}},[t._v(t._s(a.elderlyName)+" ")])})),e("span",[t._v("的家属")])],2):e("span",[t._v("暂无所属关系")])]}}])}),e("el-table-column",{attrs:{prop:"createDate",label:"调用日期"}})],1),e("el-pagination",{staticStyle:{"text-align":"center","margin-top":"20px"},attrs:{background:"",layout:"prev, pager, next",total:t.total,"pager-count":11,"page-size":t.pageSize,"current-page":t.currentPage},on:{"current-change":t.pageChange}})],1)],1)},r=[],i=a(2618),l={name:"Log",data(){return{careHome:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).careHomeName:"",log:{},logList:[],currentPage:1,pageSize:5,total:0,keyword:"",searchMode:"desc_function"}},methods:{load(){this.request.get("/api-log/query",{params:{name:this.careHome}}).then((t=>{"200"===t.code?(this.log=t.data,this.getCharts()):this.$notify({type:"error",message:t.msg,title:"日志信息获取失败"})})).catch((t=>{this.$notify({type:"error",message:t,title:"日志信息获取失败"})}))},getCharts(){this.$echarts.init(this.$refs.chart1).setOption({tooltip:{trigger:"item",formatter:"<span style='font-weight: bold'>{b}</span> <br/>{a}: {c} ({d}%)",position:"top",confine:!0},legend:{data:Object.keys(this.log.apiDistribution),textStyle:{color:" ",fontWeight:"bold"},itemGap:15,orient:"vertical",top:0,left:0},series:[{name:"接口调用次数",type:"pie",center:["65%","45%"],radius:["50%","80%"],data:Object.keys(this.log.apiDistribution).map((t=>({value:this.log.apiDistribution[t],name:t,labelLine:{position:"inner",show:!1},label:{show:!1}}))),itemStyle:{borderWidth:"1",borderColor:"#000"}}]}),this.$echarts.init(this.$refs.chart2).setOption({tooltip:{trigger:"item",formatter:"<span style='font-weight: bold'>{b}</span> <br/>{a}: {c}",position:"top",confine:!0},xAxis:{data:Object.keys(this.log.apiTimesTrend).reverse()},yAxis:{},series:[{name:"日接口调用数",type:"line",data:Object.values(this.log.apiTimesTrend).reverse()}]})},pageChange(t){this.currentPage=t,this.search()},search(){this.request.get("/api-log/search",{params:{pageNum:this.currentPage,pageSize:this.pageSize,keyword:this.keyword,type:this.searchMode,name:this.careHome}}).then((t=>{"200"===t.code?(this.logList=t.data.records,this.total=parseInt(t.data.total)):this.$notify({type:"error",title:"获取日志记录失败",message:t.msg})})).catch((t=>{this.$notify({type:"error",title:"获取日志记录失败",message:t})}))},handleClick(t){this.searchMode=t},exportRecords(){window.location.href="https://"+i.I+"/api-log/export/"+this.careHome}},mounted(){this.load(),this.search(),this.$refs.here.appendChild(this.$refs.dropdown.popperElm)},computed:{btnWord(){switch(this.searchMode){case"desc_function":return"根据接口描述搜索";case"user_id":return"根据调用用户搜索";case"create_date":return"根据调用日期搜索";default:return"搜索"}}}},o=l,n=a(1001),c=(0,n.Z)(o,s,r,!1,null,"dce188cc",null),p=c.exports}}]);
//# sourceMappingURL=493.c4ff5cdb.js.map