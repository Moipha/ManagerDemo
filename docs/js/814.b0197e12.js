"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[814],{2814:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"flexColumn",staticStyle:{"overflow-y":"scroll","margin-top":"60px"}},[t("el-card",{staticClass:"box-card card flexColumn",staticStyle:{height:"150px","flex-shrink":"0","margin-top":"-70px"}},[t("span",{staticClass:"mText"},[e._v(e._s(e.careHomeName))]),t("el-row",{staticStyle:{"margin-top":"20px"}},[t("el-col",{attrs:{span:8}},[t("div",{staticClass:"flexColumn",staticStyle:{"align-items":"center"}},[t("span",{staticClass:"lText",staticStyle:{"margin-bottom":"10px"}},[e._v(e._s(e.elderData.total))]),t("span",{staticClass:"sText"},[e._v("全部老人数")])])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"flexColumn",staticStyle:{"align-items":"center"}},[t("span",{staticClass:"lText",staticStyle:{"margin-bottom":"10px"}},[e._v(e._s(e.elderData.selfCareCount))]),t("span",{staticClass:"sText"},[e._v("可自理老人数")])])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"flexColumn",staticStyle:{"align-items":"center"}},[t("span",{staticClass:"lText",staticStyle:{"margin-bottom":"10px"}},[e._v(e._s(e.elderData.overEighty))]),t("span",{staticClass:"sText"},[e._v("80岁以上老人数")])])])],1)],1),t("el-card",{staticClass:"box-card card flexColumn specialCard",staticStyle:{"margin-top":"20px","flex-shrink":"0"}},[t("div",{staticClass:"flexRow",staticStyle:{"margin-bottom":"20px","margin-top":"10px"}},[t("div",{staticStyle:{"margin-right":"auto","margin-left":"20px"}},[t("el-input",{staticClass:"input",attrs:{"suffix-icon":"el-icon-search",clearable:""},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.load.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),t("el-dropdown",{attrs:{size:"large","split-button":"",trigger:"click"},on:{click:function(t){return e.load()},command:e.handleClick}},[t("span",{staticStyle:{color:"var(--btnText)"}},[e._v(e._s(e.btnWord))]),t("el-dropdown-menu",{ref:"dropdown",staticStyle:{"background-color":"var(--lightBg)!important",border:"none"},attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"elderly_name"}},[e._v("根据老人姓名搜索")]),t("el-dropdown-item",{attrs:{command:"age"}},[e._v("根据老人年龄搜索")]),t("el-dropdown-item",{attrs:{command:"sex"}},[e._v("根据老人性别搜索")]),t("el-dropdown-item",{attrs:{command:"bed_number"}},[e._v("根据老人床号搜索")]),t("el-dropdown-item",{attrs:{command:"id_card_number"}},[e._v("根据身份证号搜索")]),t("el-dropdown-item",{attrs:{command:"awareness"}},[e._v("根据认知能力搜索")])],1)],1)],1),t("div",{ref:"here"}),t("div",{staticClass:"flexRow",staticStyle:{"margin-left":"auto","margin-right":"10px"}},[t("el-button",{staticClass:"success",on:{click:e.openAdd}},[t("i",{staticClass:"el-icon-plus",staticStyle:{"font-weight":"bold","margin-right":"5px"}}),e._v("添加老人 ")]),t("el-upload",{staticStyle:{"margin-left":"10px"},attrs:{action:"https://"+e.serverIp+"/elderly-information/import/"+e.careHome.id,"on-success":e.uploadSuccess,"on-error":e.uploadError,"before-upload":e.checkFileType,"show-file-list":!1}},[t("el-button",{staticStyle:{padding:"12px 15px","margin-right":"10px"}},[t("i",{staticClass:"el-icon-download",staticStyle:{"font-weight":"bold","margin-right":"5px"}}),e._v("批量导入 ")])],1),t("el-button",{on:{click:e.exportElder}},[t("i",{staticClass:"el-icon-upload2",staticStyle:{"font-weight":"bold","margin-right":"5px"}}),e._v("导出Excel ")])],1)]),t("el-table",{attrs:{data:e.list,"header-cell-style":{height:"70px"},"row-style":{height:"62px"}}},[t("el-table-column",{attrs:{width:"10px"}}),t("el-table-column",{attrs:{label:"老人照片","class-name":"cellClass"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-avatar",{attrs:{src:e.row.image,shape:"square",size:40}})]}}])}),t("el-table-column",{attrs:{prop:"elderlyName",label:"老人姓名"}}),t("el-table-column",{attrs:{prop:"age",label:"年龄"}}),t("el-table-column",{attrs:{prop:"sex",label:"性别"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(1===t.row.sex?"男":"女")+" ")]}}])}),t("el-table-column",{attrs:{prop:"bedNumber",label:"床号"}}),t("el-table-column",{attrs:{prop:"selfCareAbility",label:"自理能力"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("selfCareAbility")(t.row.selfCareAbility))+" ")]}}])}),t("el-table-column",{attrs:{prop:"awareness",label:"认知能力","min-width":"100"}}),t("el-table-column",{attrs:{"min-width":"110",prop:"idCardNumber",label:"身份证号"}}),t("el-table-column",{attrs:{"min-width":"90",prop:"admissionDate",label:"入院日期"}}),t("el-table-column",{attrs:{"min-width":"90",prop:"dischargeDate",label:"出院日期"}}),t("el-table-column",{attrs:{width:"20px"}}),t("el-table-column",{attrs:{"class-name":"cellClass",label:"操作",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button-group",{staticClass:"flexRow",staticStyle:{"align-self":"center"}},[t("el-button",{staticClass:"btnOption primary",on:{click:function(t){return e.openEdit(a.row)}}},[t("span",{staticClass:"el-icon-edit"})]),t("el-popconfirm",{attrs:{title:"确定删除该老人的信息吗?"},on:{confirm:function(t){return e.delElder(a.row)}}},[t("el-button",{staticClass:"btnOption danger",attrs:{slot:"reference"},slot:"reference"},[t("span",{staticClass:"el-icon-delete"})])],1)],1)]}}])}),t("el-table-column",{attrs:{width:"10px"}})],1),t("el-pagination",{staticStyle:{"text-align":"center","margin-top":"20px"},attrs:{background:"",layout:"prev, pager, next",total:e.total,"pager-count":11,"page-size":e.pageSize,"current-page":e.currentPage},on:{"current-change":e.pageChange}})],1),t("el-dialog",{ref:"dialog",staticClass:"dl",attrs:{visible:e.dialog,"show-close":!1,limit:1,"modal-append-to-body":!1,"append-to-body":!1},on:{"update:visible":function(t){e.dialog=t},close:e.closeDialog}},[t("h1",{staticStyle:{"font-size":"24px","padding-top":"20px",color:"var(--deepText)"},attrs:{align:"center"}},[e._v(e._s(e.isAdd?"添加":"修改")+"老人信息")]),t("el-divider"),t("div",{staticStyle:{margin:"0 10% 0",padding:"3% 5% 1%","overflow-y":"scroll",height:"400px"}},[t("el-form",{ref:"form",attrs:{model:e.elder,"label-width":"140px","label-position":"left"}},[t("el-form-item",{attrs:{label:"老人图片"}},[t("el-upload",{ref:"avatar",staticClass:"avatar-uploader",attrs:{limit:1,"show-file-list":!1,"on-change":e.uploadChange,action:"https://"+e.serverIp+"/elderly-information/elder/upload","auto-upload":!1,"list-type":"picture","on-success":e.handleUpload}},[e.upload?t("el-image",{staticClass:"avatar",attrs:{src:e.upload}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1)],1),t("el-form-item",{attrs:{label:"老人姓名"}},[t("el-input",{staticStyle:{width:"180px"},model:{value:e.elder.elderlyName,callback:function(t){e.$set(e.elder,"elderlyName",t)},expression:"elder.elderlyName"}})],1),t("el-form-item",{attrs:{label:"性别"}},[t("el-radio-group",{model:{value:e.elder.sex,callback:function(t){e.$set(e.elder,"sex",t)},expression:"elder.sex"}},[t("el-radio-button",{staticStyle:{"margin-right":"1px"},attrs:{label:1}},[e._v("男")]),t("el-radio-button",{attrs:{label:0}},[e._v("女")])],1)],1),t("el-form-item",{attrs:{label:"年龄"}},[t("el-input",{staticStyle:{width:"60px"},model:{value:e.elder.age,callback:function(t){e.$set(e.elder,"age",t)},expression:"elder.age"}})],1),t("el-form-item",{attrs:{label:"床号"}},[t("el-input",{staticStyle:{width:"100px"},model:{value:e.elder.bedNumber,callback:function(t){e.$set(e.elder,"bedNumber",t)},expression:"elder.bedNumber"}})],1),t("el-form-item",{attrs:{label:"身份证号"}},[t("el-input",{staticStyle:{width:"200px"},model:{value:e.elder.idCardNumber,callback:function(t){e.$set(e.elder,"idCardNumber",t)},expression:"elder.idCardNumber"}})],1),t("el-form-item",{attrs:{label:"自理能力"}},[t("el-select",{staticStyle:{width:"105px"},model:{value:e.elder.selfCareAbility,callback:function(t){e.$set(e.elder,"selfCareAbility",t)},expression:"elder.selfCareAbility"}},[t("el-option",{attrs:{value:0,label:"能力完好"}}),t("el-option",{attrs:{value:1,label:"轻度受损"}}),t("el-option",{attrs:{value:2,label:"中度受损"}}),t("el-option",{attrs:{value:3,label:"重度受损"}})],1)],1),t("el-form-item",{attrs:{label:"认知能力"}},[t("el-select",{staticStyle:{width:"135px"},model:{value:e.elder.awareness,callback:function(t){e.$set(e.elder,"awareness",t)},expression:"elder.awareness"}},[t("el-option",{attrs:{value:"无认知障碍"}}),t("el-option",{attrs:{value:"轻度认知障碍"}}),t("el-option",{attrs:{value:"中度认知障碍"}}),t("el-option",{attrs:{value:"重度认知障碍"}})],1)],1),t("el-form-item",{attrs:{label:"入院日期"}},[t("el-date-picker",{staticStyle:{width:"140px"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"请选择",clearable:!1},model:{value:e.elder.admissionDate,callback:function(t){e.$set(e.elder,"admissionDate",t)},expression:"elder.admissionDate"}})],1),t("el-form-item",{attrs:{label:"离院日期"}},[t("el-date-picker",{staticStyle:{width:"140px"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"请选择",clearable:!1},model:{value:e.elder.dischargeDate,callback:function(t){e.$set(e.elder,"dischargeDate",t)},expression:"elder.dischargeDate"}})],1)],1)],1),t("el-divider"),t("div",{staticStyle:{display:"flex","flex-direction":"row"}},[e.isAdd?t("el-button",{staticClass:"formBtn",on:{click:e.clickAdd}},[e._v("添加")]):t("el-button",{staticClass:"formBtn",on:{click:e.clickUpdate}},[e._v("修改")]),t("el-button",{staticClass:"formBtn",on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1)},s=[],r=a(2618),i={name:"Elder",data(){return{careHomeName:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).careHomeName:"",elder:{},list:[],elderData:{},currentPage:1,pageSize:7,total:0,keyword:"",searchMode:"elderly_name",dialog:!1,isAdd:!0,serverIp:r.I,upload:"",careHome:{}}},methods:{query(){this.request.get("/elderly-information/query",{params:{name:this.careHomeName}}).then((e=>{"200"===e.code?this.elderData=e.data:this.$notify({type:"error",title:"获取相关信息失败",message:e.msg})})).catch((e=>{this.$notify({type:"error",title:"获取相关信息失败",message:e})}))},load(){this.request.get("/elderly-information/search",{params:{pageNum:this.currentPage,pageSize:this.pageSize,keyword:this.keywordC,type:this.searchMode,name:this.careHomeName}}).then((e=>{"200"===e.code?(this.list=e.data.records,this.total=parseInt(e.data.total),this.total/this.pageSize+1<this.currentPage&&(this.currentPage=1,this.load())):this.$notify({type:"error",title:"获取老人列表失败",message:e.msg})})).catch((e=>{this.$notify({type:"error",title:"获取老人列表失败",message:e})}))},handleClick(e){this.searchMode=e},pageChange(e){this.currentPage=e,this.load()},closeDialog(){this.elder={},this.dialog=!1,this.upload="",this.$refs.avatar.uploadFiles=[]},openEdit(e){this.isAdd=!1,this.elder=e,this.dialog=!0,this.upload=e.image},clickAdd(){this.$refs.avatar.uploadFiles.length?this.$refs.avatar.submit():this.addElder()},addElder(){this.elder.currentCareHomeId=this.careHome.id,this.request.post("/elderly-information/add-elder",this.elder).then((e=>{"200"===e.code?(this.$notify({type:"success",title:"成功",message:"老人信息添加成功"}),this.dialog=!1,this.load(),this.query()):this.$notify({type:"error",title:"老人信息添加失败",message:e.msg})})).catch((e=>{this.$notify({type:"error",title:"老人信息添加失败",message:e})}))},uploadChange(e){const t=new FileReader;t.readAsDataURL(e.raw),t.onload=()=>{this.upload=t.result}},handleUpload(e){"200"!==e.code?this.$notify({title:"老人照片上传失败",message:e.msg,type:"error"}):(this.$notify({title:"老人照片上传成功",message:e.msg,type:"success"}),this.elder.image=e.data[0]),this.isAdd?this.addElder():this.updateElder()},clickUpdate(){this.$refs.avatar.uploadFiles.length?this.$refs.avatar.submit():this.updateElder()},updateElder(){this.request.put("/elderly-information/update-elder",this.elder).then((e=>{"200"===e.code?(this.$notify({type:"success",title:"成功",message:"老人信息更新成功"}),this.dialog=!1):this.$notify({type:"error",title:"老人信息更新失败",message:e.msg})})).catch((e=>{this.$notify({type:"error",title:"老人信息更新失败",message:e})}))},delElder(e){this.request.delete("/elderly-information/delete-elder?id="+e.elderlyId).then((t=>{"200"===t.code?(this.$notify({type:"success",title:"删除成功",message:e.elderlyName+"的信息已删除"}),this.load(),this.query()):this.$notify({type:"error",title:"老人信息删除失败",message:t.msg})})).catch((e=>{this.$notify({type:"error",title:"老人信息删除失败",message:e})}))},getCareHome(){this.request.get("/details/query-by-name?name="+this.careHomeName).then((e=>{"200"===e.code?this.careHome=e.data:this.$notify({type:"error",title:"获取养老院信息失败",message:e.msg})})).catch((e=>{this.$notify({type:"error",title:"获取养老院信息失败",message:e})}))},openAdd(){this.isAdd=!0,this.elder={},this.dialog=!0,this.upload=""},exportElder(){window.location.href="https://"+r.I+"/elderly-information/export/"+this.careHome.id},uploadSuccess(e){"200"===e.code?(this.$notify({type:"success",title:"成功",message:"药品信息导入成功"}),this.load()):this.$notify({type:"error",title:"药品信息导入失败",message:e.msg})},uploadError(e){this.$notify({type:"error",title:"药品信息导入失败",message:e})},checkFileType(e){const t=e.name.substring(e.name.lastIndexOf(".")+1);return"xlsx"!==t&&"xls"!==t&&this.$notify({type:"error",title:"文件类型错误",message:"上传文件需是Excel文件!"}),"xlsx"===t||"xls"===t}},mounted(){this.query(),this.load(),this.getCareHome(),this.$refs.here.appendChild(this.$refs.dropdown.popperElm)},computed:{btnWord(){switch(this.searchMode){case"elderly_name":return"根据老人姓名搜索";case"age":return"根据老人年龄搜索";case"sex":return"根据老人性别搜索";case"bed_number":return"根据老人床号搜索";case"id_card_number":return"根据身份证号搜索";case"awareness":return"根据认知能力搜索";default:return"搜索"}},keywordC(){return"sex"===this.searchMode?"男"===this.keyword?"1":"女"===this.keyword?"0":"2":this.keyword}},filters:{selfCareAbility(e){switch(e){case 0:return"能力完好";case 1:return"轻度受损";case 2:return"中度受损";case 3:return"重度受损"}}}},o=i,n=a(1001),d=(0,n.Z)(o,l,s,!1,null,"5a5ed0ca",null),c=d.exports}}]);
//# sourceMappingURL=814.b0197e12.js.map